Организаци кода в Go
====================

## Обзор

- Как правило Go программисты, держат весь свой код в одном рабочем пространстве.
- Рабочая область содержит много репозиториев контроля версий (под управлением Git, например).
- Каждый репозиторий содержит один или несколько пакетов.
- Каждый пакет состоит из одного или нескольких исходных файлов Go в одном каталоге.
- Путь к каталогу из пакета определяет его путь импорта.

*Обратите внимание, что это отличается от других сред программирования, 
в котопых каждый проект имеет отдельное рабочее пространство и 
рабочие области тесно связаны с хранилищем управления версиями.*


## Рабочая область (Workspaces)

Рабочая область представляет собой иерархию каталогов с тремя каталогами в корне:

src - `содержит исходные файлы`
pkg - `содержит обьекты пакета`
bin - `содержит исполняемые файлы`


## Переменная среды GOPATH

Переменная GOPATH определяет путь к директории вашего рабочего пространства. 
Это единственная переменная окружения которую вам следует установить 
перед разработкой на Go.

Чтобы начать работу, создайте каталог рабочего пространства и 
установите переменную его в GOPATH. Ваше рабочее пространство может 
находиться где угодно, но мы будем использовать $HOME/work в примере ниже. 
Обратите внимание, что путь к рабочему пространству не должен быть там же 
где установлен Go. (Еще можно сделать так GOPATH=$HOME.)

``` bash
$ mkdir $HOME/work
$ export GOPATH=$HOME/work
```

Для удобства, добавьте подкаталог `bin` рабочего пространства к вашей перемнной окружения PATH:

```
$ export PATH=$PATH:$GOPATH/bin
```

Чтобы узнать больше о настройке переменной среды GOPATH, 
выполните команду `go help gopath`

## Пути импорта (Import paths)

Путь импорта является строкой, которая однозначно идентифицирует пакет. 
Путь пакета импорта соответствует своему расположению внутри рабочего пространства 
или в удаленном хранилище (описано ниже).

Пакеты из стандартной библиотеки используют короткие пути импорта, 
такие как `"fmt"` и `"net/http"`. Для своих пакетов, вы должны выбрать базовый путь, 
который не будет конфликтовать с будущими дополнениями к стандартной 
библиотеке или другими внешними библиотеками.

Если вы держите свой код в системе контроля версий, то 
вы должны использовать корень этого хранилища в качестве базового пути. 
Например, если у вас есть учетная запись на GitHub `github.com/user`, 
который должен быть вашим базовым путём.

Обратите внимание, что вам не нужно публиковать свой код в системе контроля версий, 
прежде чем вы начнете разработку. Это просто хорошая привычка, чтобы организовать свой код, 
как если бы вы опубликовали его когда-нибудь. На практике вы можете 
выбрать любое произвольное имя пути, но он должен быть уникальным для 
стандартной библиотеки и большой экосистемы Go.

Мы будем использовать `github.com/user` в качестве нашего базового пути. 
Создайте папку внутри вашего рабочего окружения, в который мы сохраним исходный код:

``` bash
$ mkdir -p $GOPATH/src/github.com/user
```

## Ваша первая программа

Для компиляции и запуска простой программы, для начала выберите путь пакета 
(мы будем использовать github.com/user/hello) и создайте соответствующий каталог 
пакета внутри вашего рабочего окружения:

``` bash
$ mkdir $GOPATH/src/github.com/user/hello
```

Затем создайте файл с именем hello.go внутри этого каталога, содержащий следующий строчки кода:

``` go
package main

import "fmt"

func main() {
	fmt.Printf("Hello, world.\n")
}
```

Теперь вы можете собрать и установить эту программу с помощью go инструментов:

``` bash
$ go install github.com/user/hello
```

Обратите внимание, что вы можете выплнить эту команду из любой директории в вашей системе. 
Инструменты go находят исходный код путем поиска пакета `github.com/user/hello` 
внутри рабочего окружения, заданного в GOPATH.

Вы также можете не указывать путь, если выпоните команду и каталога пакета:

``` bash
$ cd $GOPATH/src/github.com/user/hello
$ go install
```

Эта команда собирает и компилирует программу, создавая исполняемый файл. 
Затем он устанавливает исполняемый файл в каталог рабочего окружения 
как hello (или под Windows, hello.exe).

Инструменты go будут печатать только вывод при возникновении ошибки, 
поэтому, если эти команды не производят никакого вывода они успешно выполнены.

Теперь вы можете запустить программу, набрав полный путь в командной строке:

```
$ $GOPATH/bin/hello
Hello, world.
```

Или, если вы добавили `$GOPATH/bin` к вашему `PATH`, просто введите имя исполняемого файла:

```
$ hello
Hello, world.
```

Если вы используете систему контроля версий, хорошее время, чтобы инициализировать репозиторий, 
добавьте файлы, и загрузите их в репозиторий. Опять же, этот шаг не является обязательным: 
вам не нужно использовать систему контроля версиями, чтобы написать код на Go.

## Названия пакетов

Первое оператор в исходном файле Go должен быть:

``` go
package name
```

где name это имя для импорта по умолчанию. 
(Все файлы в пакете должны использовать это же имя.)

В go именем пакета является последний элемент пути импорта: 
например пакет импортируеться как "crypto/rot13" должен быть назван rot13.

## Тестирование

Go имеет легкую интегрированную тестовую среду, состоящую из команды 
`go test` и пакета `"testing"`.

Для того чтобы написать тест вам необходимо создать файл с именем 
заканчивающимся на `_test.go`, который содержит функции, назавнные 
TestXXX с сигнатурой `func (t *testing.T)`.
При запуске теста выполняеться каждая такая функция; если функция 
завершаеться с ошибками такими как `t.Error` или `t.Fail`, тест 
считается не пройденым.
 
### Советы и рекомендации по написанию Unit тестов
 
- Помещайте свои тесты в другом пакете

Go говорит нам что файлы в одной папке должны принадлежать одному 
пакету, т.е. `_test.go` файлы не исключение.Перемещение тестового 
кода из пакет позволяет писать тесты как если бы они были 
пользовательским пакетом.

Это позволяет вам изменять основной код без необходимости править тестовый код.

- Размещайте внутренние тесты в отдельном файле

Если вам нужен unit тест некоторой внутренней бизнес логики, 
создайте файл c `_internal_test.go` в качестве суффикса.
 
- Выполняйте все тесты при сохранении

Go собирает и выполнет код очень быстро, так что практически нет причин, 
почему вы не должны запускать весь ваш набор тестов каждый раз, 
когда нажмаете сохранить.

*Так же можно запускать  go vet, golint и goimports*

- Пишите провайдеров данных для тестов

Провайдеры данных позволяют писать очень четкие и простые тесты.

Следующий код позволяет установить ряд тестов для пока ненаписанной функции `Fib`:

``` go
var fibProvider = []struct {
  value   int
  expected int
}{
  {1, 1},
  {2, 1},
  {3, 2},
  {4, 3},
  {5, 5},
  {6, 8},
  {7, 13},
}

func TestFib(t *testing.T) {
  for _, tt := range fibTests {
    actual := Fib(tt.value)
    if actual != tt.expected {
      t.Errorf("Fib(%d): expected %d, actual %d", tt.value, tt.expected, actual)
    }
  }
}
```